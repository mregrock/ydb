# Миграция на ручную конфигурацию State Storage и статической группы

Данный документ содержит инструкции по миграции на конфигурацию кластера с ручным управлением [State Storage](../../../../reference/configuration/index.md#domains-state) и [статической группой](../../../../reference/configuration/index.md#blob_storage_config), посредством отключения их автоматической конфигурации.

{% note info %}

Данная инструкция предназначена для аварийных ситуаций, когда после перехода на автоматическую конфигурацию возникли непредвиденные проблемы и требуется откат на ручное управление. В штатном режиме работы эта процедура не требуется.

О подобных проблемах рекомендуется незамедлительно сообщать {% if audience != "corp" %}в виде [GitHub issue](https://github.com/ydb-platform/ydb/issues/new){% else %}в техническую поддержку {{ ydb-full-name }}{% endif %}, предоставляя максимум контекста и диагностики для воспроизведения.

{% endnote %}

## Исходное состояние

Миграция на ручную конфигурацию может быть осуществлена в том случае, если в кластере используется [конфигурация v2](../../../configuration-management/index.md). Это может быть достигнуто:

- либо в результате [миграции на конфигурацию v2](migration-to-v2.md)
- либо при [первоначальном развёртывании](../initial-deployment.md) кластера

## Процедура миграции

Для выключения автоматической конфигурации кластера выполните следующие действия:

1. Получить текущий конфигурацию кластера с помощью команды:

```bash
ydb -e grpc://<node.ydb.tech>:2135 admin storage fetch --full > config.yaml
```

Аргумент `--full` указывает, что будет получена полная конфигурация кластера, включая параметры настройки [State Storage](../../../../reference/configuration/index.md#domains-state) и [статической группы](../../../../reference/configuration/index.md#blob_storage_config).

2. Поменять в `self_management_config.enabled` значение `true` на `false`:

```yaml
self_management_config:
  enabled: false
```

3. Выполнить следующую команду с изменённым конфигурационным файлом:

```bash
ydb -e grpc://<node.ydb.tech>:2135 admin storage replace -f config.yaml
```

4. Разложить обновлённый конфигурационный файл по всем нодам кластера.

5. Перезапустить все узлы кластера с помощью процедуры [rolling-restart](../../../../maintenance/manual/node_restarting.md).

В результате проделанных действий кластер будет переведён в режим ручного управления State Storage и статической группой.
