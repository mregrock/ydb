# Миграция на конфигурацию v2

Данный документ содержит инструкцию по миграции с [конфигурации v1](../before-v25.1/configuration-management/config-overview.md) на [конфигурацию v2](../index.md).

## Исходное состояние

Миграция на конфигурацию v2 может быть осуществлена в случае выполнения следующих условий:

1. Кластер {{ydb-short-name}} [обновлен](../../../maintenance/upgrade.md) до версии 25.1 и выше.
1. Кластер {{ydb-short-name}} сконфигурирован с файлом [статической конфигурации](../before-v25.1/configuration-management/config-overview.md#static-config) `config.yaml`, разложенным по узлам и подключенным через аргумент `ydbd --yaml-config`.

## Переход на конфигурацию v2

Для того чтобы перевести кластер {{ ydb-short-name }} на механизм конфигурации v2, необходимо проделать следующие шаги:

1. Проверить наличие файла [динамической конфигурации](../before-v25.1/configuration-management/config-overview.md#dynamic-config) на кластере. Для этого необходимо выполнить команду:

    ```bash
    ydb -e grpc://<node.ydb.tech>:2135 admin cluster config fetch > config.yaml
    ```
    В случае отсутствия файла динамической конфигурации на кластере, команда выдаст сообщение:

    ```
    YAML config is absent on this cluster.
    ```

1. (В случае отсутствия файла динамической конфигурации на кластере) Выполнить команду генерации файла динамической конфигурации. Файл будет сгенерирован на основе файла статической конфигурации, лежащего на узлах кластера:

    ```bash
    ydb -e grpc://<node.ydb.tech>:2135 admin cluster config generate > config.yaml
    ```

1. Разместить полученный файл `config.yaml` по всем узлам кластера, заменив старый файл конфигурации. Таким образом мы избавляемся от файлов статической и динамической конфигурации, переходя на единый формат конфигурационного файла.

1. Выполнить следующую команду с новым конфигурационным файлом:

    ```bash
    ydb -e grpc://<node.ydb.tech>:2135 admin storage replace -f config.yaml
    ```

4. Перезапустить все узлы кластера с помощью процедуры [rolling-restart](../../../../maintenance/manual/node_restarting.md).

В результате проделанных действий кластер будет переведён в режим работы с файлом динамической конфигурации. Файл статической конфигурации больше не используется.
